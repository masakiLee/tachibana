import{b as k}from"./bootstrap.bundle.min-451d1da1.js";import{_ as w,o as l,c,b as o,H as r,K as _,O as M,t as u,e as m,r as v,F as D,l as y,d as g,p as x,h as E}from"./index-2dbe31a9.js";import{S as p}from"./sweetalert2.all-7b106dbc.js";const V={props:["isNew","coupon"],emits:["update-coupon"],data(){return{couponModal:"",tempCoupon:{},due_date:""}},methods:{},mounted(){this.couponModal=new k.Modal(this.$refs.couponModal,{keyboard:!1})},watch:{coupon(){this.tempCoupon=this.coupon;const e=new Date(this.tempCoupon.due_date*1e3).toISOString().split("T");[this.due_date]=e},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}}},A={class:"modal fade",tabindex:"-1",ref:"couponModal"},P={class:"modal-dialog modal-dialog-centered"},T={class:"modal-content"},F={class:"modal-header bg-primary text-white"},I={key:0},N={key:1},B=o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),U={class:"modal-body"},S={class:"mb-3"},L=o("label",{for:"title"},"標題",-1),z={class:"mb-3"},O=o("label",{for:"coupon_code"},"優惠碼",-1),R={class:"mb-3"},H=o("label",{for:"due_date"},"到期日",-1),K={class:"mb-3"},j=o("label",{for:"price"},"折扣百分比",-1),q={class:"mb-3"},G={class:"form-check"},J=o("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),Q={class:"modal-footer"},W=o("button",{type:"button",class:"btn btn-secondary text-white","data-bs-dismiss":"modal"}," 取消 ",-1);function X(e,t,d,f,s,i){return l(),c("div",A,[o("div",P,[o("div",T,[o("div",F,[d.isNew?(l(),c("span",I,"新增優惠卷")):(l(),c("span",N,"編輯優惠卷")),B]),o("div",U,[o("div",S,[L,r(o("input",{type:"text",class:"form-control",id:"title",placeholder:"請輸入標題","onUpdate:modelValue":t[0]||(t[0]=n=>s.tempCoupon.title=n)},null,512),[[_,s.tempCoupon.title]])]),o("div",z,[O,r(o("input",{type:"text",class:"form-control",id:"coupon_code",placeholder:"請輸入優惠碼","onUpdate:modelValue":t[1]||(t[1]=n=>s.tempCoupon.code=n)},null,512),[[_,s.tempCoupon.code]])]),o("div",R,[H,r(o("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":t[2]||(t[2]=n=>s.due_date=n)},null,512),[[_,s.due_date]])]),o("div",K,[j,r(o("input",{type:"number",class:"form-control",id:"price",min:"0",max:"100",placeholder:"請輸入折扣百分比","onUpdate:modelValue":t[3]||(t[3]=n=>s.tempCoupon.percent=n)},null,512),[[_,s.tempCoupon.percent,void 0,{number:!0}]])]),o("div",q,[o("div",G,[r(o("input",{class:"form-check-input",type:"checkbox",id:"is_enabled","true-value":1,"false-value":0,"onUpdate:modelValue":t[4]||(t[4]=n=>s.tempCoupon.is_enabled=n)},null,512),[[M,s.tempCoupon.is_enabled]]),J])])]),o("div",Q,[W,o("button",{type:"button",class:"btn btn-primary",onClick:t[5]||(t[5]=n=>e.$emit("update-coupon",s.tempCoupon))},u(d.isNew?"新增優惠卷":"更新優惠券"),1)])])])],512)}const Y=w(V,[["render",X]]),Z={props:["couponData"],emits:["del-item"],data(){return{tempCoupon:{}}},methods:{},mounted(){this.couponDelModal=new k.Modal(this.$refs.couponDelModal,{keyboard:!1})}},oo={ref:"couponDelModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},to={class:"modal-dialog modal-dialog-centered"},eo={class:"modal-content border-0"},so=o("div",{class:"modal-header bg-danger text-white"},[o("h5",{id:"delProductModalLabel",class:"modal-title"},[o("span",null,"刪除優惠券")]),o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),no={class:"modal-body"},ao={class:"text-primary"},io=o("strong",{class:"text-danger"},null,-1),lo={class:"modal-footer"},co=o("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function po(e,t,d,f,s,i){return l(),c("div",oo,[o("div",to,[o("div",eo,[so,o("div",no,[m(" 是否刪除 "),o("span",ao,u(d.couponData.title),1),io,m(" 優惠券 (刪除後將無法恢復)。 ")]),o("div",lo,[co,o("button",{type:"button",class:"btn btn-danger text-white",onClick:t[0]||(t[0]=n=>e.$emit("del-item"))}," 確認刪除 ")])])])],512)}const ro=w(Z,[["render",po]]);const{VITE_APP_URL:h,VITE_APP_PATH:b}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/",VITE_APP_PATH:"tachibanazushi",BASE_URL:"/tachibana/",MODE:"production",DEV:!1,PROD:!0},uo={data(){return{coupons:[],tempCoupon:{title:"",is_enabled:0,percent:100,code:""},isNew:!1}},components:{CouponModal:Y,CouponDelModal:ro},methods:{getCoupon(){this.$http.get(`${h}v2/api/${b}/admin/coupons`).then(e=>{this.coupons=e.data.coupons,this.page=e.data.pagination,e.data.success&&p.fire({toast:!0,title:"取得優惠券成功",icon:"success",position:"top-end",showConfirmButton:!1,timer:1500,background:"#F2ECDD",color:"#F25C05"})}).catch(e=>{p.fire({toast:!0,title:`${e.response.data.message}`,icon:"error",position:"top-end",showConfirmButton:!1,timer:1500,background:"#F2ECDD",color:"#000000"})})},openModal(e,t){e==="new"?(this.isNew=!0,this.tempCoupon={due_date:new Date().getTime()/1e3},this.$refs.modal.couponModal.show()):e==="edit"?(this.isNew=!1,this.tempCoupon={...t},this.$refs.modal.couponModal.show()):e==="delete"&&(this.$refs.delModal.couponDelModal.show(),this.tempCoupon={...t})},updateCoupon(){let e=`${h}v2/api/${b}/admin/coupon`,t="post";this.isNew||(e=`${h}v2/api/${b}/admin/coupon/${this.tempCoupon.id}`,t="put"),this.$http[t](e,{data:this.tempCoupon}).then(d=>{this.$refs.modal.couponModal.hide(),this.getCoupon(),p.fire({toast:!0,title:`${d.data.message}`,icon:"success",position:"top-end",showConfirmButton:!1,timer:1500,background:"#F2ECDD",color:"#F25C05"})}).catch(d=>{const s=d.response.data.message.map(a=>a.split(" ")[1]),i={title:"標題",is_enabled:"是否啟用",percent:"百分比",code:"代碼"},n=s.map(a=>i[a]),C=s.map((a,$)=>`${n[$]}為必填`);p.fire({toast:!0,title:`${C}`,icon:"error",position:"top-end",showConfirmButton:!1,timer:1500,background:"#F2ECDD",color:"#000000"})})},delCoupon(){const e=`${h}v2/api/${b}/admin/coupon/${this.tempCoupon.id}`;this.$http.delete(e).then(t=>{this.$refs.delModal.couponDelModal.hide(),this.getCoupon(),p.fire({toast:!0,title:`${t.data.message}`,icon:"success",position:"top-end",showConfirmButton:!1,timer:1500,background:"#F2ECDD",color:"#F25C05"})}).catch(t=>{p.fire({toast:!0,title:`${t.response.data.message}`,icon:"error",position:"top-end",showConfirmButton:!1,timer:1500,background:"#F2ECDD",color:"#000000"})})}},mounted(){const e=document.cookie.replace(/(?:(?:^|.*;\s*)LoginToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=`${e}`,this.getCoupon()}},mo=e=>(x("data-v-fecb1f84"),e=e(),E(),e),_o={class:"coupon"},ho={class:"container text-dark"},bo=mo(()=>o("h2",{class:"py-8"},[o("i",{class:"bi bi-bookmark-star-fill pe-3"}),m("優惠券管理頁面 ")],-1)),fo={class:"row"},Co={class:"coupon-card border border-dark border-3 text-center"},$o={class:"p-3 bg-dark text-white"},wo={class:"title fw-bold p-3"},vo={class:"p-3"},go={class:"percent text-primary"},ko=["onClick"],Mo=["onClick"];function Do(e,t,d,f,s,i){const n=v("CouponModal"),C=v("CouponDelModal");return l(),c("section",_o,[o("div",ho,[bo,o("button",{type:"button",class:"btn btn-dark text-white d-block ms-auto btn-lg mb-4",onClick:t[0]||(t[0]=a=>i.openModal("new"))}," 新增優惠券 "),o("div",fo,[(l(!0),c(D,null,y(s.coupons,a=>(l(),c("div",{class:"col-lg-4 mb-4",key:a.id},[o("div",Co,[o("p",$o,u(a.code),1),o("p",wo,u(a.title),1),o("p",vo,[m(" 折扣 "),o("span",go,u(a.percent),1),m(" % ")]),o("button",{type:"button",class:"btn btn-primary text-white w-50 btn-lg",onClick:$=>i.openModal("edit",a)}," 修改",8,ko),o("button",{type:"button",class:"btn btn-danger text-white w-50 btn-lg",onClick:$=>i.openModal("delete",a)}," 刪除 ",8,Mo)])]))),128))]),g(n,{ref:"modal","is-new":s.isNew,coupon:s.tempCoupon,onUpdateCoupon:i.updateCoupon},null,8,["is-new","coupon","onUpdateCoupon"]),g(C,{ref:"delModal","coupon-data":s.tempCoupon,onDelItem:i.delCoupon},null,8,["coupon-data","onDelItem"])])])}const Vo=w(uo,[["render",Do],["__scopeId","data-v-fecb1f84"]]);export{Vo as default};
